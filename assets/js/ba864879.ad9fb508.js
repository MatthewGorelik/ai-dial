"use strict";(self.webpackChunkdial=self.webpackChunkdial||[]).push([[620],{1691:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var o=s(5893),t=s(1151);const r={},i="Roles Management Guide",a={id:"tutorials/roles-management",title:"Roles Management Guide",description:"AI DIAL enables assignment of roles to Models, Applications, Addons, and Assistants to restrict the number of tokens that can be transmitted in a specific time frame. These roles and their limitations can be created in external systems and then assigned in AI DIAL's configuration.",source:"@site/docs/tutorials/roles-management.md",sourceDirName:"tutorials",slug:"/tutorials/roles-management",permalink:"/tutorials/roles-management",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"CustomSideBar",previous:{title:"Launch AI DIAL Chat with To-Do List Addon",permalink:"/tutorials/quick-start-with-addon"},next:{title:"Chat User Guide",permalink:"/user-guide"}},l={},c=[{value:"KeyCloak",id:"keycloak",level:2},{value:"Step 1: Create groups",id:"step-1-create-groups",level:3},{value:"Step 2: Create roles",id:"step-2-create-roles",level:3},{value:"Step 3: Map roles to groups",id:"step-3-map-roles-to-groups",level:3},{value:"Step 4: Assign groups to users",id:"step-4-assign-groups-to-users",level:3},{value:"Step 5: Assign KeyCloak roles to AI DIAL Core deployments",id:"step-5-assign-keycloak-roles-to-ai-dial-core-deployments",level:3},{value:"Microsoft Azure Active Directory",id:"microsoft-azure-active-directory",level:2},{value:"Step 1: Create groups in Microsoft Azure Active Directory",id:"step-1-create-groups-in-microsoft-azure-active-directory",level:3},{value:"Step 2: Include groups into JWT custom claim",id:"step-2-include-groups-into-jwt-custom-claim",level:3},{value:"Step 3: Assign MS Azure AD groups to AI DIAL Core deployments",id:"step-3-assign-ms-azure-ad-groups-to-ai-dial-core-deployments",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"roles-management-guide",children:"Roles Management Guide"}),"\n",(0,o.jsx)(n.p,{children:"AI DIAL enables assignment of roles to Models, Applications, Addons, and Assistants to restrict the number of tokens that can be transmitted in a specific time frame. These roles and their limitations can be created in external systems and then assigned in AI DIAL's configuration."}),"\n",(0,o.jsx)(n.p,{children:"This tutorial provides a guide on how to create these roles in both KeyCloak and MS Azure, and how to integrate them into AI DIAL's configuration."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"/Deployment/configuration#some-of-the-dynamic-parameters",children:"AI DIAL Configuration"})," to learn more abour ",(0,o.jsx)(n.code,{children:"roles"})," and other parameters."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"keycloak",children:"KeyCloak"}),"\n",(0,o.jsx)(n.p,{children:"In this instruction, you will learn how to create roles in KeyCloak and add them to AI DIAL Models, Applications, Assistants, and Addons."}),"\n",(0,o.jsxs)(n.p,{children:["In KeyCloak ",(0,o.jsx)(n.strong,{children:"target realm"}),":"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a group(s)"}),"\n",(0,o.jsx)(n.li,{children:"Create role(s)"}),"\n",(0,o.jsx)(n.li,{children:"Map roles to groups"}),"\n",(0,o.jsx)(n.li,{children:"Assign groups to users"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"In AI DIAL config:"}),"\n",(0,o.jsxs)(n.ol,{start:"5",children:["\n",(0,o.jsx)(n.li,{children:"Assign roles to AI DIAL Models, Applications, Assistants, and Addons."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["AI DIAL Core receives the roles assigned to it through user access tokens (JWTs). These roles can be accessed via the path: ",(0,o.jsx)(n.code,{children:"resource_access.<client-id>.roles"})," where ",(0,o.jsx)(n.code,{children:"client-id"})," is a client registered in KeyCloak ",(0,o.jsx)(n.code,{children:"realm"}),", e.g. ",(0,o.jsx)(n.code,{children:"chatbot-ui"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"step-1-create-groups",children:"Step 1: Create groups"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/index.html#proc-managing-groups_server_administration_guide",children:"KeyCloak Documentation"})," to learn how to create groups."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.strong,{children:"Groups"}),", you can create a hierarchy of groups through admin console, similar to this example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"  Models\n     -> AWS.Bedrock\n     -> Stable.Diffusion\n  Addons\n     -> Wolfram   \n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-2-create-roles",children:"Step 2: Create roles"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/index.html#con-client-roles_server_administration_guide",children:"KeyCloak Documentation"})," to learn how to create roles."]}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In ",(0,o.jsx)(n.strong,{children:"Clients"}),", choose the client ",(0,o.jsx)(n.code,{children:"chatbot-ui"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["In the table ",(0,o.jsx)(n.strong,{children:"Roles"}),", create required roles, for example:"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"AWS.Bedrock"}),"\n",(0,o.jsx)(n.li,{children:"Stable.Diffusion"}),"\n",(0,o.jsx)(n.li,{children:"Wolfram"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-3-map-roles-to-groups",children:"Step 3: Map roles to groups"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.strong,{children:"Groups"}),", do the roles mapping for each group:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Open the tab ",(0,o.jsx)(n.strong,{children:"Role Mapping"})]}),"\n",(0,o.jsxs)(n.li,{children:["Press the button ",(0,o.jsx)(n.strong,{children:"Assign role"})," and choose a role you want to assign to a group"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-4-assign-groups-to-users",children:"Step 4: Assign groups to users"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In ",(0,o.jsx)(n.strong,{children:"Groups"}),", choose a group you want to work with"]}),"\n",(0,o.jsxs)(n.li,{children:["In ",(0,o.jsx)(n.strong,{children:"Members"}),", press the button ",(0,o.jsx)(n.strong,{children:"Add member"})]}),"\n",(0,o.jsx)(n.li,{children:"Select a member you want to assign to a group"}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/index.html#proc-managing-groups_server_administration_guide",children:"KeyCloak Documentation"})," for the detailed info about group assignments."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-5-assign-keycloak-roles-to-ai-dial-core-deployments",children:"Step 5: Assign KeyCloak roles to AI DIAL Core deployments"}),"\n",(0,o.jsx)(n.p,{children:"The last step is to assign KeyCloak roles to AI DIAL core deployments: Applications, Addons, Assistants and Models."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"/Deployment/configuration#some-of-the-dynamic-parameters",children:"AI DIAL Configuration"})," to learn more."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'"addons": {\n    "search": {\n      "endpoint": "http://localhost:7010/search",\n      "displayName": "Search",\n      "userRoles": ["keycloak-role1"]\n    }\n }\n\n...\n\n"applications": {\n    "app": {\n      "endpoint": "http://localhost:7001/openai/deployments/app/chat/completions",\n      "userRoles": ["keycloak-role2"]\n    }\n  }\n\n...\n\n"assistant": {\n        "endpoint": "http://assistant.dial-development/openai/deployments/assistant/chat/completions",\n        "assistants": {\n            "assistant-1": {\n                "prompt": "Your system prompt.",\n                "addons": [\n                    "addon-1",\n                    "addon-2"\n                ],\n                "userRoles": ["keycloak-role1"]\n            }\n        }\n    }\n\n...\n\n"models": {\n    "chat-gpt-35-turbo": {\n      "type": "chat",      \n      "endpoint" : "http://localhost:7001/v1/openai/deployments/gpt-35-turbo/chat/completions",\n      "upstreams": [\n        {"endpoint": "http://localhost:7001", "key": "modelKey1"},\n        {"endpoint": "http://localhost:7002", "key": "modelKey2"},\n        {"endpoint": "http://localhost:7003", "key": "modelKey3"}\n      ],\n      "userRoles": ["keycloak-role2"]      \n    }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"microsoft-azure-active-directory",children:"Microsoft Azure Active Directory"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"/tutorials/azure-ad-configuration",children:"Azure AD Configuration"})," to learn how to enable authentication with Azure AD for AI DIAL."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"In this instruction, you will learn how to create roles in MS Azure Active Directory and add them to AI DIAL Models, Applications, Assistants, and Addons."}),"\n",(0,o.jsx)(n.p,{children:"Group management process is consisted of three steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create groups in Microsoft Azure Active Directory"}),"\n",(0,o.jsxs)(n.li,{children:["Include groups into JWT custom ",(0,o.jsx)(n.code,{children:"claim"})]}),"\n",(0,o.jsx)(n.li,{children:"Assign roles to AI DIAL Models, Applications, Assistants, and Addons"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The roles are provided to AI DIAL Core via user access token(JWT) by MS Azure AD and are available via the path: ",(0,o.jsx)(n.code,{children:"groups"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"step-1-create-groups-in-microsoft-azure-active-directory",children:"Step 1: Create groups in Microsoft Azure Active Directory"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In ",(0,o.jsx)(n.strong,{children:"Groups"}),", you can create groups that you need"]}),"\n",(0,o.jsx)(n.li,{children:"Add members for each group"}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-groups",children:"MS Documentation"})," to view the detailed info about group management."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-2-include-groups-into-jwt-custom-claim",children:"Step 2: Include groups into JWT custom claim"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In Microsoft Entra ID, open the item ",(0,o.jsx)(n.strong,{children:"App Registrations"})]}),"\n",(0,o.jsx)(n.li,{children:"Open the application you want to configure groups for"}),"\n",(0,o.jsxs)(n.li,{children:["Go to the item ",(0,o.jsx)(n.strong,{children:"Token Configuration"})]}),"\n",(0,o.jsxs)(n.li,{children:["Press the button ",(0,o.jsx)(n.strong,{children:"Add Groups claim"})," and customize which groups you want to include and where (access, ID token)"]}),"\n",(0,o.jsxs)(n.li,{children:["When customizing the claim ",(0,o.jsx)(n.strong,{children:"groups"}),", you can choose the option ",(0,o.jsx)(n.strong,{children:"sAMAccountName"})," instead of ",(0,o.jsx)(n.strong,{children:"Group ID"})," to include group names instead of group UUIDs in the token"]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-fed-group-claims#important-caveats-for-this-functionality",children:"MS Documentation"})," to view the detailed info about configuration of group claims for applications."]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": by default, the claim ",(0,o.jsx)(n.strong,{children:"groups"})," is not included into the access token. You should add a ",(0,o.jsx)(n.strong,{children:"scope"})," to the authorization request to obtain an access token.\nThe ",(0,o.jsx)(n.strong,{children:"claim"})," is available in the ID token only.\nRefer to ",(0,o.jsx)(n.a,{href:"https://stackoverflow.com/questions/70542675/azure-ad-access-token-does-not-contain-groups-claim",children:"stackoverflow"})," to read more about this case."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["How to create a custom ",(0,o.jsx)(n.strong,{children:"scope"}),":"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Go to ",(0,o.jsx)(n.strong,{children:"Expose an API"})]}),"\n",(0,o.jsxs)(n.li,{children:["Set ",(0,o.jsx)(n.strong,{children:"Application ID URI"})," to something meaningful, e.g ",(0,o.jsx)(n.code,{children:"api://chatbot-ui"})]}),"\n",(0,o.jsxs)(n.li,{children:["Press the button ",(0,o.jsx)(n.strong,{children:"Add a scope"})]}),"\n",(0,o.jsxs)(n.li,{children:["Fill the required fields in the form to create a new scope. Make sure ",(0,o.jsx)(n.strong,{children:"Who can consent?"})," is set to ",(0,o.jsx)(n.strong,{children:"Admin and users"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Add the ",(0,o.jsx)(n.strong,{children:"scope"})," to the authorization request in ",(0,o.jsx)(n.code,{children:"params"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"AzureProvider({\n      clientId: process.env.AUTH_AZURE_AD_CLIENT_ID,\n      clientSecret: process.env.AUTH_AZURE_AD_SECRET,\n      tenantId: process.env.AUTH_AZURE_AD_TENANT_ID,\n      name: process.env.AUTH_AZURE_AD_NAME ?? DEFAULT_NAME,\n      authorization: {\n        params: { scope: 'api://chatbot-ui/Client.Consumer openid profile user.Read email offline_access' },\n      },\n      token: tokenConfig,\n    }),\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": if the custom ",(0,o.jsx)(n.code,{children:"scope"})," is provided, the rest of ",(0,o.jsx)(n.code,{children:"scopes"})," in the authorization request is ignored by Microsoft Azure AD.\nAs a result, clients who have requested the access token do not have access to MS Azure Graph API for reading user info such as user picture and job title."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-3-assign-ms-azure-ad-groups-to-ai-dial-core-deployments",children:"Step 3: Assign MS Azure AD groups to AI DIAL Core deployments"}),"\n",(0,o.jsx)(n.p,{children:"The last step is to assign Microsoft Azure AD groups to AI DIAL Core deployments: Applications, Addons, Assistants and Models."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"/Deployment/configuration#some-of-the-dynamic-parameters",children:"AI DIAL Configuration"})," to learn more."]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": in the example below, MS Azure groups are mapped to AI DIAL Core user roles one to one."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'"addons": {\n    "search": {\n      "endpoint": "http://localhost:7010/search",\n      "displayName": "Search",\n      "userRoles": ["azure-group1"]\n    }\n }\n\n...\n\n"applications": {\n    "app": {\n      "endpoint": "http://localhost:7001/openai/deployments/app/chat/completions",\n      "userRoles": ["azure-group2"]\n    }\n  }\n\n...\n\n"assistant": {\n        "endpoint": "http://assistant.dial-development/openai/deployments/assistant/chat/completions",\n        "assistants": {\n            "assistant-1": {\n                "prompt": "Your system prompt.",\n                "addons": [\n                    "addon-1",\n                    "addon-2"\n                ],\n                "userRoles": ["azure-group1"]\n            }\n        }\n    }\n\n...\n\n"models": {\n    "chat-gpt-35-turbo": {\n      "type": "chat",      \n      "endpoint" : "http://localhost:7001/v1/openai/deployments/gpt-35-turbo/chat/completions",\n      "upstreams": [\n        {"endpoint": "http://localhost:7001", "key": "modelKey1"},\n        {"endpoint": "http://localhost:7002", "key": "modelKey2"},\n        {"endpoint": "http://localhost:7003", "key": "modelKey3"}\n      ],\n      "userRoles": ["azure-group2"]      \n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>i});var o=s(7294);const t={},r=o.createContext(t);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);